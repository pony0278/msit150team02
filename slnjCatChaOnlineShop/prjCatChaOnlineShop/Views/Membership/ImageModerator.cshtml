@{
    ViewData["Title"] = "ImageModerator";
}


@section Styles{
    <!-- Bootstrap CSS -->
    <!-- Site CSS -->
    <link rel="stylesheet" href="~/css/style.css" />
    <!-- Responsive CSS -->
    <link rel="stylesheet" href="~/css/responsive.css" />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="~/css/custom.css" />
    <link rel="stylesheet" href="~/css/custom-home-details-wishlist.css" />
}
<!--提示訊息-->
<div class="toast-container position-fixed top-25 start-50 translate-middle">

    <div class="toast" role="alert" aria-live="assertive" aria-atomic="true">
        <div class="toast-header">
            <img src="..." class="rounded me-2" alt="...">
            <strong class="me-auto">訊息</strong>
            <small></small>
            <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
        <div class="toast-body">
        </div>
    </div>
</div>

<!-- Start All Title Box -->
<div class="all-title-box all-title-box-picture">
    <div class="container">
        <div class="row">
            <div class="col-lg-12">
                <h2>會員中心</h2>
                <ul class="breadcrumb">
                    <li class="breadcrumb-item"><a asp-controller="Index" asp-action="Index">首頁</a></li>
                    <li class="breadcrumb-item active">會員中心</li>
                </ul>
            </div>
        </div>
    </div>
</div>
<!-- End All Title Box -->
<!-- Start Shop Detail  -->

<div class="shop-detail-box-main">
    <div class="container">
        <div class="row">
            <!--左邊圖片區-->
            <div class="col-xl-6 col-lg-6 col-md-6">
                <form method="post" enctype="multipart/form-data" id="imgForm">
                    <img id="imgPreview" src='@Url.Content("~/images/noimage.jpg")' alt="請放入圖片" class="d-block w-100" />
                    <input type="hidden" name="memberIdForMembership" value="@ViewBag.memberIdForMembership">
                    <input type="text" name="AnnouncementContent" value="personalPicture" style="display: none;" />
                    <input type="file" name="image" id="imageInput" accept="image/*">
                    <button type="submit" id="imgChangeUrl">上傳圖片</button>
                </form>
                <!--
                <div class=" form-group">
                    <img id="imgPreview" src='@Url.Content("~/images/noimage.jpg")' alt="請放入圖片" class="d-block w-100" />
                </div>
                -->
                <div class=" form-group">
                    <label class="form-label">網址:</label>
                    <input id="imageUrl" type="text" class="form-control" value="https://cdn2.ettoday.net/images/238/238946.jpg" />
                </div>

            </div>
            <!--右邊文字審核區-->
            <div class="col-xl-6 col-lg-6 col-md-6">
                <form method="post" enctype="multipart/form-data" action="/ImageTest/UploadImage">
                    <input type="text" name="AnnouncementContent" />
                    <input type="file" name="image" />
                    <button type="submit">Upload</button>
                </form>
                <div class=" form-group">
                    <button class="btn btn-primary" onclick="reviewImage()">上傳</button>
                </div>
            </div>
        </div>

        <!-- start 展開區域 -->
        <div class="card-header">
        </div>
        <!-- end 展開區域 -->

    </div>
</div>

@section Scripts{
    <!-- ALL JS FILES -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <!-- ALL PLUGINS -->
    <script src="~/js/jquery.superslides.min.js"></script>
    <script src="~/js/bootstrap-select.js"></script>
    <script src="~/js/inewsticker.js"></script>
    <script src="~/js/bootsnav.js."></script>
    <script src="~/js/images-loded.min.js"></script>
    <script src="~/js/isotope.min.js"></script>
    <script src="~/js/owl.carousel.min.js"></script>
    <script src="~/js/baguetteBox.min.js"></script>
    <script src="~/js/form-validator.min.js"></script>
    <script src="~/js/contact-form-script.js"></script>
    <script src="~/js/custom.js"></script>

    <script type="text/javascript">
        function reviewImage() {
            //alert("anlyzeImage");
            $("#imgPreview").attr("src", $("#imageUrl").val());
            var data = {
                "DataRepresentation": "URL",
                "Value": $("#imageUrl").val()
            };
            $.ajax({
                url: "https://msit150team05cm.cognitiveservices.azure.com/contentmoderator/moderate/v1.0/ProcessImage/Evaluate",
                beforeSend: function (xhrObj) {
                    // Request headers
                    xhrObj.setRequestHeader("Content-Type", "application/json");
                    xhrObj.setRequestHeader("Ocp-Apim-Subscription-Key", "e909551b7e884bfb83978433a46a2912");
                },
                type: "POST",
                // Request body
                data: JSON.stringify(data),
            }).done(function (data) {
                alert(JSON.stringify(data));
            }).fail(function (err) {
                alert(err.statusText);
            });
        }

        $(document).ready(function () {
            $('#imgChangeUrl').click(function () {
                event.preventDefault();

                // 取得表單元素
                const form = document.querySelector('#imgForm');

                const formData = new FormData(form);
                fetch('@Url.Content("/ImageTest/UploadImage")', {
                    body: formData,
                    method: 'POST'
                })
                    .then(response => response.json())
                    .then(data => {
                        console.log("hi");
                    });
                    .catch(error => {
                        console.log("error");
                    });
            });

            //圖片預覽
            document.getElementById('imageInput').addEventListener('change', function (event) {
                var previewImage = document.getElementById('imgPreview');
                var selectedImage = event.target.files[0];

                if (selectedImage) {
                    var reader = new FileReader();
                    reader.onload = function (e) {
                        previewImage.src = e.target.result;
                    };
                    reader.readAsDataURL(selectedImage);
                } else {
                    previewImage.src = '@Url.Content("~/images/toy.png")';
                }
            });
        });
    </script>
}
